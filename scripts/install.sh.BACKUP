#!/bin/bash

#############################################
# AnchorPoint Monitoring - Installer Script
# Purpose: One-time setup for monitoring system
#############################################

echo "Starting AnchorPoint Monitoring installation..."

# Base directory (assumes script is inside log-project/scripts)
BASE_DIR="$(cd "$(dirname "$0")/.." && pwd)"
TEMPLATE_DIR="$BASE_DIR/templates"
REPORT_DIR="$BASE_DIR/reports"
LOG_DIR="$BASE_DIR/logs"

#############################################
# Step 1 - Verify Directory Structure
#############################################

echo "Verifying directory structure..."

mkdir -p "$REPORT_DIR"
mkdir -p "$LOG_DIR"

if [ ! -d "$TEMPLATE_DIR" ]; then
    echo "❌ Templates directory not found at $TEMPLATE_DIR"
    exit 1
fi

echo "Directory structure verified."

#############################################
# Step 2 - Verify Template Files Exist
#############################################

echo "Checking for template files..."

if [ -z "$(ls "$TEMPLATE_DIR"/*-template* 2>/dev/null)" ]; then
    echo "❌ No template files found in $TEMPLATE_DIR"
    echo "Installation cannot proceed without templates."
    exit 1
fi

echo "Template files verified."

#############################################
# Step 3 - Verify Required Commands
#############################################

echo "Checking required system commands..."

REQUIRED_CMDS=("df" "free" "uptime" "grep" "awk")

for cmd in "${REQUIRED_CMDS[@]}"; do
    if ! command -v "$cmd" &> /dev/null; then
        echo "❌ Required command not found: $cmd"
        exit 1
    fi
done

echo "All required system commands found."

#############################################
# Step 4 - Permissions
#############################################

echo "Setting execute permissions..."

chmod +x "$BASE_DIR/scripts/"*.sh 2>/dev/null

echo "Permissions set."

#############################################
# Installation Complete
#############################################

echo "✅ AnchorPoint Monitoring installation complete."
echo "You may now run monitor.sh"
